<html lang="en"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FugueState.ai - Initialization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <script src="/js/toast-notifications.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Inter', sans-serif; }
    .font-serif-custom { font-family: 'Newsreader', serif; }

    /* Input/Toggle Animations */
    .toggle-checkbox:checked {
        right: 0;
        border-color: #818cf8;
    }
    .toggle-checkbox:checked + .toggle-label {
        background-color: #4f46e5;
    }

    /* Fade Transition */
    .step-content {
        transition: opacity 0.5s ease, transform 0.5s ease;
        opacity: 0;
        pointer-events: none;
        position: absolute;
        width: 100%;
        top: 0;
        left: 0;
        transform: scale(0.98);
    }
    .step-content.active {
        opacity: 1;
        pointer-events: auto;
        position: relative;
        transform: scale(1);
    }

    /* Halo Animation for Step 3 */
    @keyframes pulse-halo {
        0% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.4); transform: scale(0.95); opacity: 0.8; }
        70% { box-shadow: 0 0 0 40px rgba(167, 139, 250, 0); transform: scale(1.1); opacity: 1; }
        100% { box-shadow: 0 0 0 0 rgba(167, 139, 250, 0); transform: scale(0.95); opacity: 0.8; }
    }
    .halo-ring {
        animation: pulse-halo 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    /* Custom Scrollbar for list */
    .custom-scroll::-webkit-scrollbar { width: 4px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }

    /* Background Color Shift Animation */
    @keyframes hue-rotate {
        0% {
            filter: hue-rotate(0deg) saturate(1.2);
        }
        100% {
            filter: hue-rotate(360deg) saturate(1.2);
        }
    }

    .color-shift-bg {
        animation: hue-rotate 20s linear infinite;
    }

    /* Muse Selection Effects */
    .muse-selected {
        position: relative;
        z-index: 100;
    }

    /* Analyst: Matrix Data Stream */
    @keyframes analyst-matrix {
        0% { transform: translateY(-100%); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(100%); opacity: 0; }
    }
    .analyst-effect .matrix-stream {
        position: absolute;
        font-family: 'Courier New', monospace;
        font-size: 10px;
        color: #818cf8;
        animation: analyst-matrix 2s linear infinite;
        text-shadow: 0 0 8px rgba(129, 140, 248, 0.8);
    }
    @keyframes analyst-grid {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.5); }
    }

    /* Poet: Swirling Words */
    @keyframes poet-spiral {
        0% { transform: rotate(0deg) translateX(0) scale(0); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: rotate(720deg) translateX(80px) scale(1); opacity: 0; }
    }
    .poet-effect .word-particle {
        position: absolute;
        font-family: 'Newsreader', serif;
        font-style: italic;
        color: #a78bfa;
        animation: poet-spiral 3s ease-out infinite;
        text-shadow: 0 0 10px rgba(167, 139, 250, 0.8);
    }

    /* Visualist: Color Kaleidoscope */
    @keyframes visualist-burst {
        0% { transform: scale(0) rotate(0deg); opacity: 1; }
        100% { transform: scale(3) rotate(180deg); opacity: 0; }
    }
    .visualist-effect .color-burst {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: visualist-burst 1.5s ease-out infinite;
    }
    @keyframes visualist-spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Narrator: Audio Waveform */
    @keyframes narrator-wave {
        0%, 100% { transform: scaleY(0.3); }
        50% { transform: scaleY(1); }
    }
    .narrator-effect .wave-bar {
        position: absolute;
        width: 3px;
        background: linear-gradient(to top, #10b981, #34d399);
        border-radius: 2px;
        bottom: 0;
        animation: narrator-wave 0.8s ease-in-out infinite;
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.6);
    }
    @keyframes narrator-ripple {
        0% { transform: scale(0.8); opacity: 0.8; }
        100% { transform: scale(2.5); opacity: 0; }
    }
    .narrator-effect .ripple {
        position: absolute;
        border: 2px solid #10b981;
        border-radius: 50%;
        animation: narrator-ripple 2s ease-out infinite;
    }

    /* Global pulse for selected card */
    @keyframes selected-pulse {
        0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.7); }
        50% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(167, 139, 250, 0); }
    }

    /* Highlight animation for Initialize Connection button */
    @keyframes button-highlight {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.8); }
        25% { transform: scale(1.08); box-shadow: 0 0 0 15px rgba(99, 102, 241, 0.6); }
        50% { transform: scale(1.05); box-shadow: 0 0 0 30px rgba(99, 102, 241, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }
    .highlight-pulse {
        animation: button-highlight 1.5s ease-out 3;
        border-color: rgba(99, 102, 241, 0.8) !important;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(129, 140, 248, 0.3)) !important;
    }

    /* Synthesis: Combined All Effects - The Ultimate Muse */
    @keyframes synthesis-rotate {
        0% { transform: rotate(0deg) scale(1); }
        50% { transform: rotate(180deg) scale(1.2); }
        100% { transform: rotate(360deg) scale(1); }
    }
    @keyframes synthesis-pulse {
        0%, 100% { opacity: 0.6; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.3); }
    }
    @keyframes synthesis-orb {
        0% { transform: translate(-50%, -50%) rotate(0deg) translateX(60px) rotate(0deg); opacity: 0.8; }
        100% { transform: translate(-50%, -50%) rotate(360deg) translateX(60px) rotate(-360deg); opacity: 0.3; }
    }
    @keyframes synthesis-gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    .synthesis-effect {
        position: relative;
        overflow: visible;
    }
    .synthesis-effect::before {
        content: '';
        position: absolute;
        inset: -20px;
        border-radius: 50%;
        background: conic-gradient(from 0deg, 
            rgba(99, 102, 241, 0.4) 0deg,
            rgba(167, 139, 250, 0.4) 72deg,
            rgba(251, 191, 36, 0.4) 144deg,
            rgba(16, 185, 129, 0.4) 216deg,
            rgba(99, 102, 241, 0.4) 288deg,
            rgba(99, 102, 241, 0.4) 360deg
        );
        animation: synthesis-rotate 4s linear infinite;
        filter: blur(15px);
        z-index: -1;
    }
    .synthesis-effect .synthesis-orb {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: synthesis-orb 3s linear infinite;
        box-shadow: 0 0 15px currentColor;
    }
    .synthesis-effect .synthesis-orb:nth-child(1) { color: #818cf8; animation-delay: 0s; }
    .synthesis-effect .synthesis-orb:nth-child(2) { color: #a78bfa; animation-delay: 0.6s; }
    .synthesis-effect .synthesis-orb:nth-child(3) { color: #fbbf24; animation-delay: 1.2s; }
    .synthesis-effect .synthesis-orb:nth-child(4) { color: #10b981; animation-delay: 1.8s; }
    .synthesis-effect .synthesis-matrix {
        position: absolute;
        font-family: 'Courier New', monospace;
        font-size: 8px;
        color: #818cf8;
        animation: analyst-matrix 2s linear infinite;
        text-shadow: 0 0 6px rgba(129, 140, 248, 0.8);
    }
    .synthesis-effect .synthesis-word {
        position: absolute;
        font-family: 'Newsreader', serif;
        font-style: italic;
        color: #a78bfa;
        animation: poet-spiral 3s ease-out infinite;
        text-shadow: 0 0 8px rgba(167, 139, 250, 0.8);
    }
    .synthesis-effect .synthesis-burst {
        position: absolute;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        animation: visualist-burst 1.5s ease-out infinite;
    }
    .synthesis-effect .synthesis-wave {
        position: absolute;
        width: 3px;
        background: linear-gradient(to top, #10b981, #34d399);
        border-radius: 2px;
        bottom: 0;
        animation: narrator-wave 0.8s ease-in-out infinite;
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
    }
</style>
</head>
<body class="bg-[#09090b] lg:bg-[#020408] min-h-screen flex flex-col lg:items-center lg:justify-center p-0 lg:p-8 antialiased selection:bg-indigo-500/30 selection:text-indigo-200 overflow-x-hidden text-zinc-400">

    <!-- Background (component) - Preserved -->
    <div class="aura-background-component fixed top-0 w-full h-screen -z-10" data-alpha-mask="80" style="mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent)">
        <div class="aura-background-component top-0 w-full -z-10 absolute h-full color-shift-bg">
            <div data-us-project="NMlvqnkICwYYJ6lYb064" class="absolute w-full h-full left-0 top-0 -z-10"></div>
            <script type="text/javascript">
                !function(){if(!window.UnicornStudio){window.UnicornStudio={isInitialized:!1};var i=document.createElement("script");i.src="https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.29/dist/unicornStudio.umd.js",i.onload=function(){window.UnicornStudio.isInitialized||(UnicornStudio.init(),window.UnicornStudio.isInitialized=!0)},(document.head || document.body).appendChild(i)}}();
            </script>
        </div>
    </div>

    <!-- Main Container -->
    <main class="min-h-screen lg:h-[90vh] flex flex-col lg:max-w-[1400px] lg:rounded-[2.5rem] lg:border lg:border-white/10 lg:shadow-2xl lg:shadow-black bg-black/20 w-full relative backdrop-blur-xl overflow-hidden">

        <!-- Grid Lines Background -->
        <div class="absolute inset-0 w-full h-full pointer-events-none z-0 flex justify-between px-6 md:px-12 opacity-30 md:opacity-50">
            <div class="w-px h-full bg-white/5"></div>
            <div class="w-px h-full bg-white/5 hidden sm:block"></div>
            <div class="w-px h-full bg-white/5 hidden md:block"></div>
            <div class="w-px h-full bg-white/5 hidden lg:block"></div>
            <div class="w-px h-full bg-white/5 hidden xl:block"></div>
            <div class="w-px h-full bg-white/5"></div>
        </div>

        <!-- Navigation -->
        <nav class="relative z-50 flex items-center justify-between px-6 py-6 md:px-12 md:py-8">
            <a href="../index.html" class="flex items-center gap-3 opacity-50 grayscale hover:grayscale-0 hover:opacity-100 transition-all duration-500 cursor-pointer">
                <i data-lucide="brain-circuit" class="w-5 h-5 text-indigo-400" stroke-width="1.5"></i>
                <span class="text-sm font-medium tracking-tight text-white font-serif-custom italic">FugueState.ai</span>
            </a>
            <div class="flex gap-2">
                <span id="step-dots" class="flex gap-2">
                    <div class="w-1.5 h-1.5 rounded-full bg-indigo-500 shadow-[0_0_8px_rgba(99,102,241,0.8)] transition-all" id="dot-1"></div>
                    <div class="w-1.5 h-1.5 rounded-full bg-zinc-800 transition-all" id="dot-2"></div>
                    <div class="w-1.5 h-1.5 rounded-full bg-zinc-800 transition-all" id="dot-3"></div>
                </span>
            </div>
        </nav>

        <!-- Wizard Container -->
        <div class="flex-1 z-20 flex flex-col items-center justify-center w-full px-6 relative overflow-hidden py-4">

            <div class="w-full max-w-2xl relative flex flex-col h-full">
                <!-- Step 1: Connect Sources -->
                <div id="step-1" class="step-content active flex flex-col items-center text-center h-full justify-start">
                    <h2 class="text-2xl md:text-3xl text-white font-serif-custom italic font-light tracking-tight mb-1 md:mb-2">
                        Connect your <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 to-purple-300">memories.</span>
                    </h2>
                    <p class="text-xs md:text-sm text-zinc-400 mb-4 md:mb-5 font-light max-w-sm">
                        Dameris can listen to your digital memories. Choose what she may hear.
                    </p>

                    <div class="w-full space-y-2 md:space-y-2.5 mb-4 md:mb-5 flex-1 overflow-y-auto custom-scroll px-1 min-h-0">
                        <!-- Integration Item: Google -->
                        <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/30 hover:bg-zinc-900/50 hover:border-white/10 transition-all duration-300 backdrop-blur-sm">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <span class="iconify w-4 h-4 md:w-5 md:h-5" data-icon="logos:google-gmail"></span>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">Gmail</h3>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Correspondence &amp; Drafts</p>
                                </div>
                            </div>
                            <!-- Toggle -->
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" value="" class="sr-only peer" checked="">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>

                        <!-- Integration Item: Drive -->
                        <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/30 hover:bg-zinc-900/50 hover:border-white/10 transition-all duration-300 backdrop-blur-sm">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <span class="iconify w-4 h-4 md:w-5 md:h-5" data-icon="logos:google-drive"></span>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">Google Drive</h3>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Documents &amp; Archives</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" value="" class="sr-only peer">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>

                         <!-- Integration Item: Local -->
                         <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/30 hover:bg-zinc-900/50 hover:border-white/10 transition-all duration-300 backdrop-blur-sm">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <i data-lucide="folder-lock" class="w-4 h-4 md:w-5 md:h-5 text-amber-200/70" stroke-width="1.5"></i>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">File Vault</h3>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Upload files (up to 1GB) for Dameris to reference</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" value="" class="sr-only peer">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>

                         <!-- Integration Item: MCP / Custom -->
                         <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/30 hover:bg-zinc-900/50 hover:border-white/10 transition-all duration-300 backdrop-blur-sm">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <i data-lucide="blocks" class="w-4 h-4 md:w-5 md:h-5 text-pink-200/70" stroke-width="1.5"></i>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">MCP / Custom App</h3>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Connect via Protocol or API</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" id="mcp-toggle" value="" class="sr-only peer" onchange="toggleMCPInput()">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>

                         <!-- Integration Item: Web Scrape / URL -->
                         <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/30 hover:bg-zinc-900/50 hover:border-white/10 transition-all duration-300 backdrop-blur-sm">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <i data-lucide="globe" class="w-4 h-4 md:w-5 md:h-5 text-cyan-200/70" stroke-width="1.5"></i>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">Web Scrape / URL</h3>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Scrape websites or connect AI agents</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" id="url-toggle" value="" class="sr-only peer" onchange="toggleURLInput()">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>

                        <!-- URL Input Section (hidden by default) -->
                        <div id="url-input-section" class="hidden mt-2 p-3 md:p-4 rounded-lg border border-cyan-500/20 bg-zinc-900/40 backdrop-blur-sm">
                            <div class="space-y-2.5 md:space-y-3">
                                <div>
                                    <label class="block text-[10px] md:text-xs text-zinc-400 mb-1.5">Enter URL</label>
                                    <input 
                                        type="url" 
                                        id="url-input" 
                                        placeholder="https://example.com"
                                        class="w-full bg-zinc-950/50 border border-white/10 rounded-lg px-3 py-2 text-xs md:text-sm text-zinc-200 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/20 placeholder-zinc-600"
                                    >
                                </div>
                                <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3">
                                    <div class="flex-1">
                                        <label class="block text-[10px] md:text-xs text-zinc-400 mb-1.5">Type</label>
                                        <select id="url-type" class="w-full bg-zinc-950/50 border border-white/10 rounded-lg px-3 py-2 text-xs md:text-sm text-zinc-200 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/20">
                                            <option value="scrape">Website Scrape</option>
                                            <option value="agent">AI Agent</option>
                                            <option value="mcp">MCP Protocol</option>
                                        </select>
                                    </div>
                                    <div class="flex-1">
                                        <label class="block text-[10px] md:text-xs text-zinc-400 mb-1.5">Source Name</label>
                                        <input 
                                            type="text" 
                                            id="url-source-name" 
                                            placeholder="My Website"
                                            class="w-full bg-zinc-950/50 border border-white/10 rounded-lg px-3 py-2 text-xs md:text-sm text-zinc-200 focus:outline-none focus:border-cyan-500/50 focus:ring-1 focus:ring-cyan-500/20 placeholder-zinc-600"
                                        >
                                    </div>
                                </div>
                                <button onclick="testURLConnection(event)" class="w-full px-3 py-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 border border-cyan-500/30 text-xs md:text-sm text-cyan-300 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    Test Connection
                                </button>
                            </div>
                        </div>

                        <!-- MCP Input Section (hidden by default) -->
                        <div id="mcp-input-section" class="hidden mt-2 p-3 md:p-4 rounded-lg border border-emerald-500/20 bg-zinc-900/40 backdrop-blur-sm">
                            <div class="space-y-2.5 md:space-y-3">
                                <div>
                                    <label class="block text-[10px] md:text-xs text-zinc-400 mb-1.5">MCP Endpoint URL</label>
                                    <input 
                                        type="url" 
                                        id="mcp-url-input" 
                                        placeholder="https://mcp.example.com/api"
                                        class="w-full bg-zinc-950/50 border border-white/10 rounded-lg px-3 py-2 text-xs md:text-sm text-zinc-200 focus:outline-none focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 placeholder-zinc-600"
                                    >
                                </div>
                                <div>
                                    <label class="block text-[10px] md:text-xs text-zinc-400 mb-1.5">Source Name</label>
                                    <input 
                                        type="text" 
                                        id="mcp-source-name" 
                                        placeholder="My MCP Server"
                                        class="w-full bg-zinc-950/50 border border-white/10 rounded-lg px-3 py-2 text-xs md:text-sm text-zinc-200 focus:outline-none focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/20 placeholder-zinc-600"
                                    >
                                </div>
                                <button onclick="testMCPConnection(event)" class="w-full px-3 py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-500/30 text-xs md:text-sm text-emerald-300 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                    Test MCP Connection
                                </button>
                            </div>
                        </div>

                        <!-- Integration Item: Notion (Extra) -->
                        <div class="group flex items-center justify-between p-3 md:p-3.5 rounded-lg border border-white/5 bg-zinc-900/20 hover:bg-zinc-900/40 hover:border-white/10 transition-all duration-300 backdrop-blur-sm opacity-70">
                            <div class="flex items-center gap-3 flex-1 min-w-0">
                                <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-zinc-800/50 flex items-center justify-center border border-white/5 text-zinc-400 group-hover:text-white transition-colors flex-shrink-0">
                                    <span class="iconify w-4 h-4 md:w-5 md:h-5 invert opacity-70" data-icon="logos:notion-icon"></span>
                                </div>
                                <div class="text-left min-w-0 flex-1">
                                    <div class="flex items-center gap-2">
                                        <h3 class="text-xs md:text-sm font-medium text-zinc-200 truncate">Notion</h3>
                                        <span class="text-[9px] px-1.5 py-0.5 rounded bg-zinc-800/60 text-zinc-300 border border-white/10">Extra</span>
                                    </div>
                                    <p class="text-[10px] md:text-xs text-zinc-300 truncate">Notes &amp; Wikis (optional)</p>
                                </div>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer flex-shrink-0 ml-2">
                                <input type="checkbox" value="" class="sr-only peer" checked="">
                                <div class="w-9 h-5 md:w-11 md:h-6 bg-zinc-800 peer-focus:outline-none rounded-full peer dark:bg-zinc-800 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 md:after:h-5 md:after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600 shadow-[inset_0_1px_4px_rgba(0,0,0,0.5)]"></div>
                            </label>
                        </div>
                    </div>

                    <button id="initialize-connection-btn" onclick="nextStep(2)" class="group w-full md:w-auto relative inline-flex items-center justify-center px-6 md:px-8 py-2 md:py-2.5 overflow-hidden font-medium text-indigo-100 transition duration-300 ease-out border border-indigo-500/30 rounded-full shadow-md group text-sm md:text-base shrink-0">
                        <span class="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-indigo-600 group-hover:translate-x-0 ease">
                        <i data-lucide="arrow-right" class="w-4 h-4 md:w-5 md:h-5"></i>
                        </span>
                        <span class="absolute flex items-center justify-center w-full h-full text-indigo-100 transition-all duration-300 transform group-hover:translate-x-full ease">Initialize Connection</span>
                        <span class="relative invisible">Initialize Connection</span>
                    </button>
                </div>

                <!-- Step 2: Choose Muse -->
                <div id="step-2" class="step-content flex flex-col items-center text-center h-full justify-start">
                    <h2 class="text-2xl md:text-3xl text-white font-serif-custom italic font-light tracking-tight mb-2">
                        Choose your <span class="text-transparent bg-clip-text bg-gradient-to-r from-violet-300 to-amber-200">Muse.</span>
                    </h2>
                    <p class="text-xs md:text-sm text-zinc-400 mb-4 md:mb-5 font-light">
                        Who shall interpret your digital dreams?
                    </p>

                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3 md:gap-4 w-full mb-4 md:mb-6 flex-1 overflow-y-auto custom-scroll min-h-0">
                        <!-- Card 1: Analyst -->
                        <div id="muse-analyst" onclick="selectMuse('analyst')" class="muse-card group cursor-pointer relative p-4 rounded-xl border border-white/10 bg-zinc-900/40 hover:bg-zinc-900/80 hover:border-indigo-500/50 transition-all duration-300 flex flex-col items-center gap-3 overflow-hidden">
                            <div class="absolute inset-0 bg-indigo-500/5 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="effect-container absolute inset-0 pointer-events-none"></div>
                            <div class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center group-hover:scale-110 transition-transform duration-500 shadow-inner relative z-10">
                                <i data-lucide="bar-chart-2" class="w-5 h-5 text-indigo-300" stroke-width="1.5"></i>
                            </div>
                            <div class="text-center relative z-10">
                                <h3 class="text-sm font-semibold text-zinc-200 mb-1">Analyst</h3>
                                <p class="text-[10px] uppercase tracking-widest text-zinc-400">Logic &amp; Pattern</p>
                            </div>
                        </div>

                        <!-- Card 2: Poet -->
                        <div id="muse-poet" onclick="selectMuse('poet')" class="muse-card group cursor-pointer relative p-4 rounded-xl border border-white/10 bg-zinc-900/40 hover:bg-zinc-900/80 hover:border-violet-500/50 transition-all duration-300 flex flex-col items-center gap-3 overflow-hidden">
                            <div class="absolute inset-0 bg-violet-500/5 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="effect-container absolute inset-0 pointer-events-none"></div>
                            <div class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center group-hover:scale-110 transition-transform duration-500 shadow-inner relative z-10">
                                <i data-lucide="feather" class="w-5 h-5 text-violet-300" stroke-width="1.5"></i>
                            </div>
                            <div class="text-center relative z-10">
                                <h3 class="text-sm font-semibold text-zinc-200 mb-1">Poet</h3>
                                <p class="text-[10px] uppercase tracking-widest text-zinc-400">Verse &amp; Metaphor</p>
                            </div>
                        </div>

                        <!-- Card 3: Visualist -->
                        <div id="muse-visualist" onclick="selectMuse('visualist')" class="muse-card group cursor-pointer relative p-4 rounded-xl border border-white/10 bg-zinc-900/40 hover:bg-zinc-900/80 hover:border-amber-500/50 transition-all duration-300 flex flex-col items-center gap-3 overflow-hidden">
                            <div class="absolute inset-0 bg-amber-500/5 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="effect-container absolute inset-0 pointer-events-none"></div>
                            <div class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center group-hover:scale-110 transition-transform duration-500 shadow-inner relative z-10">
                                <i data-lucide="eye" class="w-5 h-5 text-amber-300" stroke-width="1.5"></i>
                            </div>
                            <div class="text-center relative z-10">
                                <h3 class="text-sm font-semibold text-zinc-200 mb-1">Visualist</h3>
                                <p class="text-[10px] uppercase tracking-widest text-zinc-400">Image &amp; Color</p>
                            </div>
                        </div>

                        <!-- Card 4: Narrator -->
                        <div id="muse-narrator" onclick="selectMuse('narrator')" class="muse-card group cursor-pointer relative p-4 rounded-xl border border-white/10 bg-zinc-900/40 hover:bg-zinc-900/80 hover:border-emerald-500/50 transition-all duration-300 flex flex-col items-center gap-3 overflow-hidden">
                            <div class="absolute inset-0 bg-emerald-500/5 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="effect-container absolute inset-0 pointer-events-none"></div>
                            <div class="w-12 h-12 rounded-full bg-zinc-800 flex items-center justify-center group-hover:scale-110 transition-transform duration-500 shadow-inner relative z-10">
                                <i data-lucide="mic-2" class="w-5 h-5 text-emerald-300" stroke-width="1.5"></i>
                            </div>
                            <div class="text-center relative z-10">
                                <h3 class="text-sm font-semibold text-zinc-200 mb-1">Narrator</h3>
                                <p class="text-[10px] uppercase tracking-widest text-zinc-400">Voice &amp; Saga</p>
                            </div>
                        </div>

                        <!-- Card 5: Synthesis - The Ultimate Muse -->
                        <div id="muse-synthesis" onclick="selectMuse('synthesis')" class="muse-card group cursor-pointer relative p-4 rounded-xl border-2 border-white/20 bg-gradient-to-br from-zinc-900/60 to-zinc-950/60 hover:bg-gradient-to-br hover:from-zinc-800/80 hover:to-zinc-900/80 hover:border-white/40 transition-all duration-300 flex flex-col items-center gap-3 overflow-visible">
                            <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/10 via-violet-500/10 via-amber-500/10 to-emerald-500/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div class="effect-container absolute inset-0 pointer-events-none"></div>
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 via-violet-600 via-amber-500 to-emerald-500 flex items-center justify-center group-hover:scale-110 transition-transform duration-500 shadow-[0_0_20px_rgba(139,92,246,0.5)] relative z-10">
                                <i data-lucide="sparkles" class="w-5 h-5 text-white" stroke-width="1.5"></i>
                            </div>
                            <div class="text-center relative z-10">
                                <h3 class="text-sm font-semibold text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 via-violet-300 via-amber-300 to-emerald-300 mb-1">Synthesis</h3>
                                <p class="text-[10px] uppercase tracking-widest text-zinc-300">All &amp; Beyond</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4 shrink-0">
                        <button onclick="nextStep(1)" class="text-xs md:text-sm text-zinc-400 hover:text-zinc-300 transition-colors">Back</button>
                        <button id="awaken-button" onclick="awakenMuse()" disabled class="group relative inline-flex items-center justify-center px-6 md:px-8 py-2 md:py-2.5 overflow-hidden font-medium text-white transition duration-300 ease-out bg-zinc-800 rounded-full hover:bg-zinc-700 shadow-[0_0_20px_rgba(255,255,255,0.05)] border border-white/10 disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:bg-zinc-800 text-sm md:text-base">
                            <span class="mr-2">Awaken Muse</span>
                            <i data-lucide="sparkles" class="w-4 h-4 text-amber-200"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: First Scan -->
                <div id="step-3" class="step-content flex flex-col items-center text-center justify-center h-full pt-4 md:pt-6">

                    <!-- Ritual Animation -->
                    <div class="relative w-32 h-32 md:w-48 md:h-48 mb-6 md:mb-8 flex items-center justify-center shrink-0">
                        <!-- Outer Glow -->
                        <div class="absolute inset-0 rounded-full bg-gradient-to-tr from-indigo-500/20 via-purple-500/10 to-amber-500/20 blur-2xl animate-pulse"></div>

                        <!-- Pulsing Rings -->
                        <div class="absolute inset-0 rounded-full border border-indigo-500/20 halo-ring"></div>
                        <div class="absolute inset-4 rounded-full border border-purple-500/20 halo-ring" style="animation-delay: 0.5s"></div>
                        <div class="absolute inset-8 rounded-full border border-amber-500/20 halo-ring" style="animation-delay: 1s"></div>

                        <!-- Core -->
                        <div class="w-24 h-24 rounded-full bg-zinc-900 border border-white/10 flex items-center justify-center shadow-[0_0_30px_rgba(139,92,246,0.15)] relative z-10">
                            <i data-lucide="fingerprint" class="w-8 h-8 text-white/80 animate-pulse" stroke-width="1"></i>
                        </div>
                    </div>

                    <h2 class="text-xl md:text-2xl text-white font-serif-custom italic font-light tracking-tight mb-2 animate-pulse">
                        Listening... Reflecting... <span class="text-indigo-300">Dreaming...</span>
                    </h2>
                    <p class="text-xs md:text-sm text-zinc-400 font-mono tracking-wider uppercase text-[9px] md:text-[10px] opacity-70">
                        Analyzing neuron patterns · 402MB Synced
                    </p>

                    <div class="mt-6 md:mt-8 shrink-0">
                         <button onclick="nextStep(1)" class="text-[10px] md:text-xs text-zinc-300 hover:text-zinc-400 transition-colors border-b border-transparent hover:border-zinc-600 pb-0.5">Reset Ritual</button>
                    </div>
                </div>

            </div>

        </div>

        <!-- Footer -->
        <footer class="w-full py-6 md:px-12 px-6 z-20 text-center">
             <div class="flex items-center justify-center gap-2 mb-2">
                <i data-lucide="shield-check" class="w-3 h-3 text-zinc-300"></i>
                <p class="text-xs text-zinc-400 font-normal">
                    Your data never leaves your device unless you choose to sync.
                </p>
             </div>
        </footer>

    </main>

    <script>
        lucide.createIcons();

        let selectedMuse = null;

        function selectMuse(museName) {
            // Store selection
            selectedMuse = museName;
            localStorage.setItem('fuguestate_muse', museName);

            // Remove previous selection effects
            document.querySelectorAll('.muse-card').forEach(card => {
                card.classList.remove('muse-selected', 'analyst-effect', 'poet-effect', 'visualist-effect', 'narrator-effect', 'synthesis-effect');
                card.style.animation = '';
                const container = card.querySelector('.effect-container');
                if (container) container.innerHTML = '';
            });

            // Add selection to current card
            const card = document.getElementById(`muse-${museName}`);
            card.classList.add('muse-selected');
            card.style.animation = 'selected-pulse 2s ease-in-out infinite';

            // Create unique effect based on muse type
            const container = card.querySelector('.effect-container');

            if (museName === 'analyst') {
                card.classList.add('analyst-effect');
                createAnalystEffect(container);
            } else if (museName === 'poet') {
                card.classList.add('poet-effect');
                createPoetEffect(container);
            } else if (museName === 'visualist') {
                card.classList.add('visualist-effect');
                createVisualistEffect(container);
            } else if (museName === 'narrator') {
                card.classList.add('narrator-effect');
                createNarratorEffect(container);
            } else if (museName === 'synthesis') {
                card.classList.add('synthesis-effect');
                createSynthesisEffect(container);
            }

            // Enable the Awaken Muse button
            const awakenButton = document.getElementById('awaken-button');
            awakenButton.disabled = false;
            lucide.createIcons(); // Refresh icons
        }

        function awakenMuse() {
            if (selectedMuse) {
                nextStep(3);
            }
        }

        // Analyst: Matrix data streams
        function createAnalystEffect(container) {
            const data = ['01', '10', '11', '00', 'Σ', '∫', 'π', 'α', 'β', 'λ'];
            for (let i = 0; i < 15; i++) {
                const stream = document.createElement('div');
                stream.className = 'matrix-stream';
                stream.textContent = data[Math.floor(Math.random() * data.length)];
                stream.style.left = `${Math.random() * 100}%`;
                stream.style.animationDelay = `${Math.random() * 2}s`;
                container.appendChild(stream);
            }
        }

        // Poet: Swirling poetic words
        function createPoetEffect(container) {
            const words = ['dream', 'whisper', 'ethereal', 'muse', 'verse', 'soul', 'echo', 'memory'];
            for (let i = 0; i < 8; i++) {
                const word = document.createElement('div');
                word.className = 'word-particle';
                word.textContent = words[i % words.length];
                word.style.fontSize = `${8 + Math.random() * 6}px`;
                word.style.animationDelay = `${i * 0.3}s`;
                word.style.left = '50%';
                word.style.top = '50%';
                container.appendChild(word);
            }
        }

        // Visualist: Kaleidoscope color bursts
        function createVisualistEffect(container) {
            const colors = [
                'radial-gradient(circle, rgba(251,191,36,0.6) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(245,158,11,0.6) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(217,119,6,0.6) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(234,179,8,0.6) 0%, transparent 70%)'
            ];

            for (let i = 0; i < 5; i++) {
                const burst = document.createElement('div');
                burst.className = 'color-burst';
                burst.style.background = colors[i % colors.length];
                burst.style.left = '50%';
                burst.style.top = '50%';
                burst.style.transform = 'translate(-50%, -50%)';
                burst.style.animationDelay = `${i * 0.3}s`;
                container.appendChild(burst);
            }

            // Add spinning overlay
            container.style.animation = 'visualist-spin 3s linear infinite';
        }

        // Narrator: Audio waveform bars
        function createNarratorEffect(container) {
            for (let i = 0; i < 12; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                bar.style.height = `${20 + Math.random() * 60}%`;
                bar.style.left = `${10 + i * 7}%`;
                bar.style.animationDelay = `${i * 0.1}s`;
                container.appendChild(bar);
            }

            // Add ripple effects
            for (let i = 0; i < 3; i++) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.width = '80px';
                ripple.style.height = '80px';
                ripple.style.left = '50%';
                ripple.style.top = '50%';
                ripple.style.transform = 'translate(-50%, -50%)';
                ripple.style.animationDelay = `${i * 0.7}s`;
                container.appendChild(ripple);
            }
        }

        // Synthesis: The Ultimate Combined Effect - All Muses United
        function createSynthesisEffect(container) {
            // Rotating orbs representing each muse
            for (let i = 0; i < 4; i++) {
                const orb = document.createElement('div');
                orb.className = 'synthesis-orb';
                orb.style.left = '50%';
                orb.style.top = '50%';
                container.appendChild(orb);
            }

            // Matrix streams (Analyst)
            const data = ['01', '10', '11', '00', 'Σ', '∫', 'π', 'α', 'β', 'λ', '∞', 'φ'];
            for (let i = 0; i < 10; i++) {
                const stream = document.createElement('div');
                stream.className = 'synthesis-matrix';
                stream.textContent = data[Math.floor(Math.random() * data.length)];
                stream.style.left = `${Math.random() * 100}%`;
                stream.style.animationDelay = `${Math.random() * 2}s`;
                container.appendChild(stream);
            }

            // Poetic words (Poet)
            const words = ['dream', 'whisper', 'ethereal', 'muse', 'verse', 'soul', 'echo', 'memory', 'synthesis', 'unity'];
            for (let i = 0; i < 6; i++) {
                const word = document.createElement('div');
                word.className = 'synthesis-word';
                word.textContent = words[i % words.length];
                word.style.fontSize = `${7 + Math.random() * 5}px`;
                word.style.animationDelay = `${i * 0.4}s`;
                word.style.left = '50%';
                word.style.top = '50%';
                container.appendChild(word);
            }

            // Color bursts (Visualist)
            const colors = [
                'radial-gradient(circle, rgba(99,102,241,0.5) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(167,139,250,0.5) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(251,191,36,0.5) 0%, transparent 70%)',
                'radial-gradient(circle, rgba(16,185,129,0.5) 0%, transparent 70%)'
            ];
            for (let i = 0; i < 4; i++) {
                const burst = document.createElement('div');
                burst.className = 'synthesis-burst';
                burst.style.background = colors[i % colors.length];
                burst.style.left = '50%';
                burst.style.top = '50%';
                burst.style.transform = 'translate(-50%, -50%)';
                burst.style.animationDelay = `${i * 0.4}s`;
                container.appendChild(burst);
            }

            // Waveform bars (Narrator)
            for (let i = 0; i < 8; i++) {
                const wave = document.createElement('div');
                wave.className = 'synthesis-wave';
                wave.style.height = `${30 + Math.random() * 50}%`;
                wave.style.left = `${15 + i * 10}%`;
                wave.style.animationDelay = `${i * 0.15}s`;
                container.appendChild(wave);
            }

            // Add pulsing center glow
            const centerGlow = document.createElement('div');
            centerGlow.style.position = 'absolute';
            centerGlow.style.left = '50%';
            centerGlow.style.top = '50%';
            centerGlow.style.transform = 'translate(-50%, -50%)';
            centerGlow.style.width = '60px';
            centerGlow.style.height = '60px';
            centerGlow.style.borderRadius = '50%';
            centerGlow.style.background = 'radial-gradient(circle, rgba(139,92,246,0.4) 0%, transparent 70%)';
            centerGlow.style.animation = 'synthesis-pulse 2s ease-in-out infinite';
            centerGlow.style.filter = 'blur(10px)';
            container.appendChild(centerGlow);
        }

        function nextStep(step) {
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(el => {
                el.classList.remove('active');
                // Brief timeout to allow fade out before display none if we were doing complex JS,
                // but for simple opacity toggle via CSS class, this works.
            });

            // Show target step
            const target = document.getElementById(`step-${step}`);
            if(target) target.classList.add('active');

            // Update dots
            updateDots(step);

            // Redirect to studio after step 3
            if(step === 3) {
                setTimeout(() => {
                    window.location.href = '../studio/index.html';
                }, 3000); // Redirect after 3 seconds
            }
        }

        function updateDots(step) {
            const dots = [1, 2, 3];
            dots.forEach(d => {
                const dot = document.getElementById(`dot-${d}`);
                if (d === step) {
                    dot.classList.remove('bg-zinc-800', 'w-1.5', 'h-1.5');
                    dot.classList.add('bg-indigo-500', 'shadow-[0_0_8px_rgba(99,102,241,0.8)]', 'w-1.5', 'h-1.5');
                    // To make active dot slightly distinct if needed, but keeping simple glow as per design
                } else {
                    dot.classList.add('bg-zinc-800', 'w-1.5', 'h-1.5');
                    dot.classList.remove('bg-indigo-500', 'shadow-[0_0_8px_rgba(99,102,241,0.8)]');
                }
            });
        }

        // Toggle URL input section
        function toggleURLInput() {
            const toggle = document.getElementById('url-toggle');
            const section = document.getElementById('url-input-section');
            if (toggle?.checked) {
                section?.classList.remove('hidden');
            } else {
                section?.classList.add('hidden');
            }
        }

        // Toggle MCP input section
        function toggleMCPInput() {
            const toggle = document.getElementById('mcp-toggle');
            const section = document.getElementById('mcp-input-section');
            if (toggle?.checked) {
                section?.classList.remove('hidden');
            } else {
                section?.classList.add('hidden');
            }
        }

        // Function to scroll to and highlight the Initialize Connection button
        // Call this after file upload is complete
        window.highlightInitializeButton = function() {
            const button = document.getElementById('initialize-connection-btn');
            if (!button) return;

            // Smooth scroll to the button with offset for better visibility
            button.scrollIntoView({
                behavior: 'smooth',
                block: 'center',
                inline: 'nearest'
            });

            // Add highlight animation after a small delay for scroll to complete
            setTimeout(() => {
                button.classList.add('highlight-pulse');

                // Remove the class after animation completes
                setTimeout(() => {
                    button.classList.remove('highlight-pulse');
                }, 4500); // 1.5s * 3 iterations = 4.5s
            }, 500);
        }

        // Test URL connection (scrape or agent)
        async function testURLConnection(event) {
            const urlInput = document.getElementById('url-input');
            const urlType = document.getElementById('url-type');
            const sourceName = document.getElementById('url-source-name');
            
            if (!urlInput?.value) {
                if (window.toastNotifications) {
                    window.toastNotifications.warning('Please enter a URL');
                } else {
                    alert('Please enter a URL');
                }
                urlInput?.focus();
                return;
            }

            const button = event?.target?.closest('button') || event?.target;
            const originalText = button?.textContent;
            const originalHTML = button?.innerHTML;
            
            try {
                if (button) {
                    button.disabled = true;
                    button.innerHTML = '<span class="flex items-center gap-2"><span class="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></span>Testing...</span>';
                }

                if (urlType?.value === 'scrape') {
                    // Scrape website
                    const response = await fetch('/api/data-sources/scrape', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            url: urlInput.value,
                            sourceName: sourceName?.value || `Web: ${new URL(urlInput.value).hostname}`
                        })
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to scrape website');
                    }

                    const count = data.memoryIds?.length || 0;
                    if (window.toastNotifications) {
                        window.toastNotifications.success(`Successfully scraped website! Created ${count} memory fragment${count !== 1 ? 's' : ''}.`);
                    } else {
                        alert(`Successfully scraped website! Created ${count} memory fragments.`);
                    }
                } else {
                    // Connect to agent/MCP
                    const response = await fetch('/api/data-sources/agent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            agentUrl: urlInput.value,
                            agentType: urlType?.value || 'agent',
                            sourceName: sourceName?.value || `Agent: ${new URL(urlInput.value).hostname}`
                        })
                    });

                    const data = await response.json();
                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to connect to agent');
                    }

                    if (window.toastNotifications) {
                        window.toastNotifications.success('Successfully connected to agent!');
                    } else {
                        alert('Successfully connected to agent!');
                    }
                }

                // Clear inputs
                urlInput.value = '';
                if (sourceName) sourceName.value = '';
                document.getElementById('url-toggle')?.click(); // Uncheck toggle

            } catch (error) {
                console.error('Connection test error:', error);
                if (window.toastNotifications) {
                    window.toastNotifications.error(error.message || 'Failed to connect');
                } else {
                    alert(`Error: ${error.message || 'Failed to connect'}`);
                }
            } finally {
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalHTML || originalText || 'Test Connection';
                }
            }
        }

        // Test MCP connection
        async function testMCPConnection(event) {
            const mcpUrlInput = document.getElementById('mcp-url-input');
            const mcpSourceName = document.getElementById('mcp-source-name');
            
            if (!mcpUrlInput?.value) {
                if (window.toastNotifications) {
                    window.toastNotifications.warning('Please enter an MCP endpoint URL');
                } else {
                    alert('Please enter an MCP endpoint URL');
                }
                mcpUrlInput?.focus();
                return;
            }

            const button = event?.target?.closest('button') || event?.target;
            const originalHTML = button?.innerHTML;
            
            try {
                if (button) {
                    button.disabled = true;
                    button.innerHTML = '<span class="flex items-center gap-2"><span class="w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"></span>Testing...</span>';
                }

                const response = await fetch('/api/data-sources/agent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        agentUrl: mcpUrlInput.value,
                        agentType: 'mcp',
                        sourceName: mcpSourceName?.value || `MCP: ${new URL(mcpUrlInput.value).hostname}`
                    })
                });

                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to connect to MCP');
                }

                if (window.toastNotifications) {
                    window.toastNotifications.success('Successfully connected to MCP server!');
                } else {
                    alert('Successfully connected to MCP server!');
                }

                // Clear inputs
                mcpUrlInput.value = '';
                if (mcpSourceName) mcpSourceName.value = '';
                document.getElementById('mcp-toggle')?.click(); // Uncheck toggle

            } catch (error) {
                console.error('MCP connection error:', error);
                if (window.toastNotifications) {
                    window.toastNotifications.error(error.message || 'Failed to connect to MCP');
                } else {
                    alert(`Error: ${error.message || 'Failed to connect to MCP'}`);
                }
            } finally {
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalHTML || 'Test MCP Connection';
                }
            }
        }
    </script>

</body></html>
