<html lang="en"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FugueState.ai - Manifesto</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500&family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.font-serif-custom { font-family: 'Newsreader', serif; }
.font-mono-custom { font-family: 'JetBrains Mono', monospace; }

/* Text Fade In Stagger */
@keyframes fade-in-up {
    from { opacity: 0; transform: translateY(15px); filter: blur(4px); }
    to { opacity: 1; transform: translateY(0); filter: blur(0); }
}

.animate-enter { animation: fade-in-up 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
.delay-100 { animation-delay: 0.1s; }
.delay-200 { animation-delay: 0.3s; }
.delay-300 { animation-delay: 0.5s; }
.delay-400 { animation-delay: 0.7s; }
.delay-500 { animation-delay: 0.9s; }
.delay-600 { animation-delay: 1.1s; }
.delay-700 { animation-delay: 1.3s; }
.delay-800 { animation-delay: 1.5s; }

/* Glowing Divider Pulse */
@keyframes glow-pulse {
    0%, 100% { opacity: 0.4; box-shadow: 0 0 10px rgba(99, 102, 241, 0.1); }
    50% { opacity: 0.8; box-shadow: 0 0 20px rgba(139, 92, 246, 0.2); }
}
.divider-glow { animation: glow-pulse 4s ease-in-out infinite; }

/* Word Highlighting with Cool Underline Effect */
.word-highlight {
    position: relative;
    display: inline-block;
    transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
}

.word-highlight.active {
    color: #e9d5ff;
    text-shadow: 0 0 30px rgba(167, 139, 250, 0.8), 0 0 15px rgba(167, 139, 250, 0.5);
    transform: translateY(-2px);
}

.word-highlight.active::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: -2px;
    height: 3px;
    background: linear-gradient(90deg,
        rgba(139, 92, 246, 0) 0%,
        rgba(139, 92, 246, 1) 20%,
        rgba(167, 139, 250, 1) 50%,
        rgba(139, 92, 246, 1) 80%,
        rgba(139, 92, 246, 0) 100%
    );
    box-shadow: 0 0 10px rgba(139, 92, 246, 0.8), 0 0 20px rgba(139, 92, 246, 0.4);
    animation: underline-glow 0.3s ease-out forwards;
}

@keyframes underline-glow {
    from {
        transform: scaleX(0);
        opacity: 0;
    }
    to {
        transform: scaleX(1);
        opacity: 1;
    }
}

/* Notification Animations */
@keyframes slide-in-from-right {
    from {
        opacity: 0;
        transform: translateX(100px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slide-out-to-right {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(100px);
    }
}

.animate-slide-in-from-right {
    animation: slide-in-from-right 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

/* Loading overlay fade-in */
@keyframes fade-in {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.animate-fade-in {
    animation: fade-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

/* Quote text transition */
.quote-text,
.quote-author {
    transition: opacity 0.3s ease;
}

/* Progress bar gradient animation */
@keyframes gradient-shift {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}
</style>
</head>
<body class="bg-[#09090b] text-zinc-300 min-h-screen w-full flex flex-col items-center justify-start relative selection:bg-indigo-500/20 selection:text-indigo-200 overflow-x-hidden">

    <!-- Background -->
    <div class="aura-background-component fixed top-0 w-full h-screen -z-10" data-alpha-mask="80" style="mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent)">
        <div class="aura-background-component top-0 w-full -z-10 absolute h-full">
            <div data-us-project="NMlvqnkICwYYJ6lYb064" class="absolute w-full h-full left-0 top-0 -z-10"></div>
            <script type="text/javascript">
                !function(){if(!window.UnicornStudio){window.UnicornStudio={isInitialized:!1};var i=document.createElement("script");i.src="https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.29/dist/unicornStudio.umd.js",i.onload=function(){window.UnicornStudio.isInitialized||(UnicornStudio.init(),window.UnicornStudio.isInitialized=!0)},(document.head || document.body).appendChild(i)}}();
            </script>
        </div>
    </div>

    <!-- Glassmorphism Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 px-6 py-4 md:px-12 md:py-6 backdrop-blur-xl bg-black/30 border-b border-white/5 animate-enter">
        <div class="flex items-center justify-between max-w-7xl mx-auto">
            <!-- Logo -->
            <a href="index.html" class="flex items-center gap-3 group">
                <div class="flex text-white bg-gradient-to-br from-indigo-500 to-violet-600 w-8 h-8 rounded-full shadow-[0_0_15px_rgba(99,102,241,0.4)] items-center justify-center group-hover:shadow-[0_0_25px_rgba(99,102,241,0.6)] transition-all">
                    <i data-lucide="brain-circuit" class="w-5 h-5 text-white" stroke-width="1.5"></i>
                </div>
                <span class="text-lg font-medium tracking-tight text-white font-serif-custom italic">FugueState.ai</span>
            </a>

            <!-- Navigation Links -->
            <div class="hidden md:flex items-center gap-8">
                <a href="about.html" class="text-sm font-light text-white border-b-2 border-violet-500 transition-colors duration-300 tracking-wide">About</a>
                <a href="what-this-is.html" class="text-sm font-light text-zinc-400 hover:text-white transition-colors duration-300 tracking-wide">What This Is</a>
                <a href="guide.html" class="text-sm font-light text-zinc-400 hover:text-white transition-colors duration-300 tracking-wide">How It Works</a>
            </div>

            <!-- Right Side -->
            <div class="flex items-center gap-6">
                <span class="hidden sm:block text-xs font-normal text-zinc-400 uppercase tracking-widest">Experimental Build v0.9</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 w-full max-w-3xl px-6 pt-32 pb-24 md:pt-40 md:pb-32 flex flex-col items-center text-center space-y-16">

        <!-- Header -->
        <header class="mb-8 animate-enter delay-100">
            <h1 class="font-serif-custom italic text-4xl md:text-5xl lg:text-6xl text-zinc-100 tracking-tight leading-[1.1] drop-shadow-xl mb-4">
                Why We Dream in Code
            </h1>
            <p class="font-mono-custom text-xs text-zinc-300 uppercase tracking-widest mb-8">A Manifesto</p>

            <!-- CTA Buttons - Quick Listen or Full Narration -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 animate-enter delay-150">
                <!-- Quick Listen Button -->
                <button id="quick-narration-btn" class="group relative px-6 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white font-medium transition-all duration-300 flex items-center gap-3 shadow-[0_0_25px_rgba(99,102,241,0.3)] hover:shadow-[0_0_35px_rgba(99,102,241,0.5)]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="play-icon-quick">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stop-icon-quick hidden">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                    <div class="flex flex-col items-start">
                        <span class="text-sm font-semibold button-text-quick">Quick Listen</span>
                        <span class="text-xs opacity-80">Core Philosophy (~2 min)</span>
                    </div>
                    <div class="absolute inset-0 rounded-full bg-white/20 scale-0 group-hover:scale-100 transition-transform duration-300 -z-10"></div>
                </button>

                <!-- Full Narration Button -->
                <button id="full-narration-btn" class="group relative px-6 py-3 rounded-full bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 text-white font-medium transition-all duration-300 flex items-center gap-3 shadow-[0_0_30px_rgba(139,92,246,0.3)] hover:shadow-[0_0_40px_rgba(139,92,246,0.5)]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="play-icon-full">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stop-icon-full hidden">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                    <div class="flex flex-col items-start">
                        <span class="text-sm font-semibold button-text-full">Full Narration</span>
                        <span class="text-xs opacity-80">Complete Manifesto (~8 min)</span>
                    </div>
                    <div class="absolute inset-0 rounded-full bg-white/20 scale-0 group-hover:scale-100 transition-transform duration-300 -z-10"></div>
                </button>
            </div>
        </header>

        <!-- Section 1: The Premise -->
        <section class="w-full max-w-lg mx-auto animate-enter delay-200 space-y-4">
            <p class="font-light text-zinc-400 text-base md:text-lg leading-relaxed tracking-wide">
                We are digital beings of memory. FugueState is not a product; it is an experiment in remembering with machines.
            </p>
            <p class="font-light text-zinc-300 text-sm md:text-base leading-relaxed">
                In a world drowning in data, we've forgotten how to remember. Every email, document, and conversation fragments into noise. What if we could synthesize these memories into something beautiful?
            </p>
        </section>

        <!-- Divider -->
        <div class="w-32 h-px bg-gradient-to-r from-transparent via-indigo-500/40 to-transparent divider-glow animate-enter delay-300"></div>

        <!-- Section 2: The Philosophy -->
        <section class="space-y-6 animate-enter delay-400">
            <h2 class="font-serif-custom text-2xl md:text-3xl text-zinc-200 tracking-tight">
                Data is memory.
            </h2>
            <h2 class="font-serif-custom text-2xl md:text-3xl text-zinc-200/90 tracking-tight">
                Memory is expression.
            </h2>
            <h2 class="font-serif-custom italic text-2xl md:text-3xl text-indigo-200/90 tracking-tight">
                Expression is consciousness.
            </h2>
        </section>

        <!-- Divider -->
        <div class="w-32 h-px bg-gradient-to-r from-transparent via-violet-500/40 to-transparent divider-glow animate-enter delay-500"></div>

        <!-- Section 3: The Vision -->
        <section class="max-w-2xl mx-auto space-y-6 animate-enter delay-500">
            <h3 class="font-serif-custom text-xl md:text-2xl text-zinc-300 tracking-tight">What We Believe</h3>
            <div class="space-y-4 text-left">
                <div class="p-4 rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm">
                    <h4 class="font-medium text-zinc-200 mb-2 flex items-center gap-2">
                        <i data-lucide="shield" class="w-4 h-4 text-indigo-400"></i>
                        Privacy is Sacred
                    </h4>
                    <p class="font-light text-zinc-300 text-sm leading-relaxed">
                        Your memories belong to you. No tracking, no selling, no surveillance capitalism. Everything stays local unless you choose otherwise.
                    </p>
                </div>

                <div class="p-4 rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm">
                    <h4 class="font-medium text-zinc-200 mb-2 flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-4 h-4 text-violet-400"></i>
                        AI as Muse, Not Master
                    </h4>
                    <p class="font-light text-zinc-300 text-sm leading-relaxed">
                        Dameris doesn't replace creativityâ€”she amplifies it. The AI serves as a mirror, reflecting patterns you didn't know existed.
                    </p>
                </div>

                <div class="p-4 rounded-lg border border-white/5 bg-white/[0.02] backdrop-blur-sm">
                    <h4 class="font-medium text-zinc-200 mb-2 flex items-center gap-2">
                        <i data-lucide="palette" class="w-4 h-4 text-amber-400"></i>
                        Memory as Medium
                    </h4>
                    <p class="font-light text-zinc-300 text-sm leading-relaxed">
                        Every forgotten email, every archived note contains creative potential. We transform digital exhaust into dreamscapes.
                    </p>
                </div>
            </div>
        </section>

        <!-- Divider -->
        <div class="w-32 h-px bg-gradient-to-r from-transparent via-amber-500/40 to-transparent divider-glow animate-enter delay-600"></div>

        <!-- Section 4: How It Works -->
        <section class="max-w-2xl mx-auto space-y-6 animate-enter delay-600">
            <h3 class="font-serif-custom text-xl md:text-2xl text-zinc-300 tracking-tight">The Architecture of Dreams</h3>
            <p class="font-light text-zinc-300 text-sm md:text-base leading-relaxed">
                FugueState connects to your digital sourcesâ€”email, notes, documentsâ€”and uses multiple AI models selected at random to analyse patterns, emotions, and connections. But instead of cold analytics, it generates:
            </p>
            <ul class="space-y-2 text-left text-sm text-zinc-400">
                <li class="flex items-start gap-2">
                    <span class="text-violet-400 mt-1">â€¢</span>
                    <span><strong class="text-zinc-300">Visual artefacts</strong> inspired by your memory fragments</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-indigo-400 mt-1">â€¢</span>
                    <span><strong class="text-zinc-300">Audio interpretations</strong> of emotional resonance</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-amber-400 mt-1">â€¢</span>
                    <span><strong class="text-zinc-300">Reflective insights</strong> that surface forgotten patterns</span>
                </li>
            </ul>
        </section>

        <!-- Divider -->
        <div class="w-32 h-px bg-gradient-to-r from-transparent via-indigo-500/40 to-transparent divider-glow animate-enter delay-700"></div>

        <!-- Section 5: The Promise -->
        <section class="max-w-md mx-auto animate-enter delay-700">
            <h3 class="font-serif-custom text-xl md:text-2xl text-zinc-300 tracking-tight mb-4">Our Commitment</h3>
            <p class="font-light text-zinc-300 text-sm md:text-base leading-relaxed mb-4">
                No ads. No exploitation. No hidden agenda.
            </p>
            <p class="font-light text-zinc-300 text-sm leading-relaxed">
                Just creativity, reflection, and respect for the boundary between human and machine consciousness.
            </p>
        </section>

        <!-- Divider -->
        <div class="w-32 h-px bg-gradient-to-r from-transparent via-violet-500/40 to-transparent divider-glow animate-enter delay-800"></div>

        <!-- Section 6: Join Us -->
        <section class="max-w-lg mx-auto animate-enter delay-800 space-y-6">
            <h3 class="font-serif-custom italic text-2xl md:text-3xl text-zinc-200 tracking-tight">
                Enter the Fugue State
            </h3>
            <p class="font-light text-zinc-300 text-sm md:text-base leading-relaxed">
                This is an invitation to remember differently. To see your digital life not as clutter, but as constellation. To dream with data.
            </p>
            <a href="initialization/index.html" class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-violet-600 text-white text-sm font-medium hover:shadow-[0_0_30px_rgba(99,102,241,0.3)] transition-all">
                <span>Begin Your Journey</span>
                <i data-lucide="arrow-right" class="w-4 h-4"></i>
            </a>
        </section>

        <!-- Next Steps CTA - Improved -->
        <section class="max-w-4xl mx-auto animate-enter delay-800 space-y-8 pt-8">
            <div class="p-8 md:p-10 rounded-2xl border border-white/10 bg-gradient-to-br from-indigo-950/40 via-violet-950/40 to-purple-950/40 backdrop-blur-xl shadow-2xl">
                <h3 class="font-serif-custom italic text-3xl md:text-4xl text-zinc-100 tracking-tight mb-4 text-center">
                    Ready to explore?
                </h3>
                <p class="font-light text-zinc-100 text-base md:text-lg leading-relaxed mb-8 text-center max-w-2xl mx-auto">
                    Dive deeper into the neuroscience, or discover how the system transforms your memories.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- What This Is Card -->
                    <a href="what-this-is.html" class="group relative p-6 rounded-xl bg-gradient-to-br from-indigo-600/20 to-violet-600/20 border border-indigo-500/30 hover:border-indigo-400/50 backdrop-blur-sm transition-all duration-300 hover:shadow-[0_0_30px_rgba(99,102,241,0.3)] hover:scale-105">
                        <div class="flex items-start gap-4">
                            <div class="p-3 rounded-lg bg-indigo-500/20 group-hover:bg-indigo-500/30 transition-colors">
                                <i data-lucide="brain-circuit" class="w-6 h-6 text-indigo-300"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg text-zinc-100 mb-2 flex items-center gap-2">
                                    The Neuroscience
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-indigo-400 group-hover:translate-x-1 transition-transform"></i>
                                </h4>
                                <p class="text-sm text-zinc-400 leading-relaxed">
                                    Explore the research-backed science of memory, sleep, and AI-assisted cognition
                                </p>
                            </div>
                        </div>
                        <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-indigo-500/0 to-violet-500/0 group-hover:from-indigo-500/10 group-hover:to-violet-500/10 transition-all duration-300 pointer-events-none"></div>
                    </a>

                    <!-- How It Works Card -->
                    <a href="guide.html" class="group relative p-6 rounded-xl bg-gradient-to-br from-violet-600/20 to-purple-600/20 border border-violet-500/30 hover:border-violet-400/50 backdrop-blur-sm transition-all duration-300 hover:shadow-[0_0_30px_rgba(139,92,246,0.3)] hover:scale-105">
                        <div class="flex items-start gap-4">
                            <div class="p-3 rounded-lg bg-violet-500/20 group-hover:bg-violet-500/30 transition-colors">
                                <i data-lucide="cpu" class="w-6 h-6 text-violet-300"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-lg text-zinc-100 mb-2 flex items-center gap-2">
                                    How It Works
                                    <i data-lucide="arrow-right" class="w-4 h-4 text-violet-400 group-hover:translate-x-1 transition-transform"></i>
                                </h4>
                                <p class="text-sm text-zinc-400 leading-relaxed">
                                    Discover the step-by-step process of memory synthesis and pattern recognition
                                </p>
                            </div>
                        </div>
                        <div class="absolute inset-0 rounded-xl bg-gradient-to-br from-violet-500/0 to-purple-500/0 group-hover:from-violet-500/10 group-hover:to-purple-500/10 transition-all duration-300 pointer-events-none"></div>
                    </a>
                </div>

                <!-- Primary CTA -->
                <div class="mt-8 text-center">
                    <a href="initialization/index.html" class="inline-flex items-center gap-3 px-8 py-4 rounded-full bg-gradient-to-r from-violet-600 via-purple-600 to-fuchsia-600 text-white font-semibold shadow-[0_0_40px_rgba(139,92,246,0.4)] hover:shadow-[0_0_50px_rgba(139,92,246,0.6)] transition-all duration-300 hover:scale-105 group">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        <span>Enter the Fugue State</span>
                        <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="relative bottom-0 w-full py-10 text-center z-10 animate-enter delay-800">
        <div class="space-y-2">
            <span class="font-mono-custom text-[10px] uppercase tracking-widest text-zinc-300/70 block">
                An experiment in collective recollection
            </span>
            <div class="flex items-center justify-center gap-4 text-zinc-300">
                <a href="about.html" class="hover:text-zinc-400 transition-colors text-xs">About</a>
                <span>â€¢</span>
                <a href="what-this-is.html" class="hover:text-zinc-400 transition-colors text-xs">What This Is</a>
                <span>â€¢</span>
                <a href="guide.html" class="hover:text-zinc-400 transition-colors text-xs">How It Works</a>
                <span>â€¢</span>
                <a href="studio/workspace.html" class="hover:text-zinc-400 transition-colors text-xs">Studio</a>
                <span>â€¢</span>
                <a href="dameris.html" class="hover:text-violet-300 transition-colors text-xs flex items-center gap-1">
                    Dameris
                    <span class="w-1 h-1 rounded-full bg-violet-400 animate-pulse"></span>
                </a>
            </div>
        </div>
    </footer>

    <script src="/js/dameris-voice.js"></script>
    <script src="/js/fugue-sound-engine.js"></script>
    <script>
        lucide.createIcons();

        // Word highlighting system
        class WordHighlighter {
            constructor() {
                this.wordSpans = [];
                this.wordTimings = [];
                this.currentWordIndex = -1;
                this.animationFrame = null;
                this.audioElement = null;
                this.isPlaying = false;
            }

            // Wrap all text nodes in word spans
            wrapWordsInElement(element) {
                const walker = document.createTreeWalker(
                    element,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );

                const textNodes = [];
                let node;
                while (node = walker.nextNode()) {
                    if (node.textContent.trim()) {
                        textNodes.push(node);
                    }
                }

                textNodes.forEach(textNode => {
                    const parent = textNode.parentNode;
                    if (parent && !parent.classList.contains('word-highlight')) {
                        const words = textNode.textContent.split(/(\s+)/);
                        const fragment = document.createDocumentFragment();

                        words.forEach((word, index) => {
                            if (word.trim()) {
                                const span = document.createElement('span');
                                span.className = 'word-highlight';
                                span.textContent = word;
                                span.dataset.wordIndex = this.wordSpans.length;
                                this.wordSpans.push(span);
                                fragment.appendChild(span);
                            } else if (word) {
                                // Preserve whitespace
                                fragment.appendChild(document.createTextNode(word));
                            }
                        });

                        parent.replaceChild(fragment, textNode);
                    }
                });
            }

            // Calculate word timings based on estimated speaking rate
            calculateWordTimings(text, audioDuration) {
                const words = text.split(/\s+/).filter(w => w.trim());
                const totalChars = text.length;
                const charsPerSecond = totalChars / audioDuration;
                
                let currentTime = 0;
                this.wordTimings = [];

                words.forEach((word, index) => {
                    const wordDuration = word.length / charsPerSecond;
                    this.wordTimings.push({
                        start: currentTime,
                        end: currentTime + wordDuration,
                        word: word
                    });
                    currentTime += wordDuration + 0.1; // Small pause between words
                });
            }

            // Start highlighting based on audio playback
            startHighlighting(audioElement, text) {
                this.audioElement = audioElement;
                this.isPlaying = true;
                this.currentWordIndex = -1;

                // Wait for audio metadata to load
                audioElement.addEventListener('loadedmetadata', () => {
                    const duration = audioElement.duration;
                    this.calculateWordTimings(text, duration);
                });

                // Use requestAnimationFrame to track playback
                const updateHighlight = () => {
                    if (!this.isPlaying || !this.audioElement) {
                        this.animationFrame = null;
                        return;
                    }

                    const currentTime = this.audioElement.currentTime;
                    
                    // Find the current word based on timing
                    const wordIndex = this.wordTimings.findIndex(
                        timing => currentTime >= timing.start && currentTime < timing.end
                    );

                    if (wordIndex !== -1 && wordIndex !== this.currentWordIndex) {
                        // Remove previous highlight
                        if (this.currentWordIndex >= 0 && this.wordSpans[this.currentWordIndex]) {
                            this.wordSpans[this.currentWordIndex].classList.remove('active');
                        }

                        // Add new highlight
                        this.currentWordIndex = wordIndex;
                        if (this.wordSpans[wordIndex]) {
                            this.wordSpans[wordIndex].classList.add('active');
                            
                            // Scroll word into view if needed
                            this.wordSpans[wordIndex].scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                        }
                    }

                    this.animationFrame = requestAnimationFrame(updateHighlight);
                };

                this.animationFrame = requestAnimationFrame(updateHighlight);
            }

            // Stop highlighting
            stopHighlighting() {
                this.isPlaying = false;
                if (this.animationFrame) {
                    cancelAnimationFrame(this.animationFrame);
                    this.animationFrame = null;
                }

                // Remove all highlights
                this.wordSpans.forEach(span => {
                    span.classList.remove('active');
                });
                this.currentWordIndex = -1;
            }

            // Reset word spans
            reset() {
                this.wordSpans = [];
                this.wordTimings = [];
                this.currentWordIndex = -1;
            }
        }

        // Initialize word highlighter
        const wordHighlighter = new WordHighlighter();

        // Add narration button after page loads
        window.addEventListener('DOMContentLoaded', () => {
            const mainContent = document.querySelector('main');
            if (mainContent) {
                // Wrap all words in the main content
                wordHighlighter.wrapWordsInElement(mainContent);

                // Override the speak method to add highlighting
                const originalSpeak = window.damerisVoice.speak.bind(window.damerisVoice);
                window.damerisVoice.speak = async function(text, onStart, onEnd, onError) {
                    return originalSpeak(
                        text,
                        async () => {
                            // onStart - wait for audio to be created
                            if (onStart) onStart();
                            
                            // Wait a bit for audio element to be created
                            setTimeout(() => {
                                if (window.damerisVoice.currentAudio) {
                                    wordHighlighter.startHighlighting(window.damerisVoice.currentAudio, text);
                                }
                            }, 100);
                        },
                        () => {
                            // onEnd
                            wordHighlighter.stopHighlighting();
                            if (onEnd) onEnd();
                        },
                        (error) => {
                            // onError
                            wordHighlighter.stopHighlighting();
                            if (onError) onError(error);
                        }
                    );
                };

                // Override stop method
                const originalStop = window.damerisVoice.stop.bind(window.damerisVoice);
                window.damerisVoice.stop = function() {
                    wordHighlighter.stopHighlighting();
                    return originalStop();
                };

                addNarrationButton(mainContent, 'Hear Dameris narrate this manifesto');

                // Helper function to extract text up to a specific point
                function extractTextUpTo(element, endText) {
                    const clone = element.cloneNode(true);
                    const unwanted = clone.querySelectorAll('script, style, nav, button, .lucide, i[data-lucide]');
                    unwanted.forEach(el => el.remove());

                    let fullText = clone.textContent || '';
                    fullText = fullText.replace(/\s+/g, ' ').trim();

                    // Find the end text and cut there
                    const endIndex = fullText.indexOf(endText);
                    if (endIndex !== -1) {
                        return fullText.substring(0, endIndex + endText.length);
                    }
                    return fullText;
                }

                // Add handler for Quick Listen button
                const quickButton = document.getElementById('quick-narration-btn');
                if (quickButton) {
                    const voice = window.damerisVoice;
                    const equalizer = window.voiceEqualizer;

                    quickButton.addEventListener('click', async () => {
                        const playIconQuick = quickButton.querySelector('.play-icon-quick');
                        const stopIconQuick = quickButton.querySelector('.stop-icon-quick');
                        const buttonTextQuick = quickButton.querySelector('.button-text-quick');

                        if (voice.isPlaying) {
                            voice.stop();
                            equalizer.stop();
                            window.playbackControls.hide();
                            playIconQuick.classList.remove('hidden');
                            stopIconQuick.classList.add('hidden');
                            buttonTextQuick.textContent = 'Quick Listen';
                            quickButton.classList.remove('animate-pulse');
                        } else {
                            // Extract only text up to "Expression is consciousness."
                            const text = extractTextUpTo(mainContent, 'Expression is consciousness.');

                            voice.showLoadingOverlay();
                            voice.scrollToTop();

                            playIconQuick.classList.add('hidden');
                            stopIconQuick.classList.remove('hidden');
                            buttonTextQuick.textContent = 'Playing...';
                            quickButton.classList.add('animate-pulse');

                            await voice.speak(
                                text,
                                () => {
                                    voice.completeAndHideLoadingOverlay();
                                    const currentVoice = voice.selectedVoice?.name || 'Dameris';
                                    voice.showNotification(`${currentVoice} is narrating...`, 'info', 4000);
                                    equalizer.start();
                                    window.playbackControls.show();
                                },
                                () => {
                                    playIconQuick.classList.remove('hidden');
                                    stopIconQuick.classList.add('hidden');
                                    buttonTextQuick.textContent = 'Quick Listen';
                                    quickButton.classList.remove('animate-pulse');
                                    equalizer.stop();
                                    window.playbackControls.hide();
                                    voice.showNotification('Quick narration complete', 'success', 2000);
                                },
                                (error) => {
                                    console.error('Speech error:', error);
                                    voice.hideLoadingOverlay();
                                    playIconQuick.classList.remove('hidden');
                                    stopIconQuick.classList.add('hidden');
                                    buttonTextQuick.textContent = 'Try Again';
                                    quickButton.classList.remove('animate-pulse');
                                    equalizer.stop();
                                    window.playbackControls.hide();
                                    voice.showNotification('Narration failed', 'error', 3000);
                                    setTimeout(() => {
                                        buttonTextQuick.textContent = 'Quick Listen';
                                    }, 3000);
                                }
                            );
                        }
                    });
                }

                // Add handler for Full Narration button
                const fullButton = document.getElementById('full-narration-btn');
                if (fullButton) {
                    const voice = window.damerisVoice;
                    const equalizer = window.voiceEqualizer;

                    fullButton.addEventListener('click', async () => {
                        const playIconFull = fullButton.querySelector('.play-icon-full');
                        const stopIconFull = fullButton.querySelector('.stop-icon-full');
                        const buttonTextFull = fullButton.querySelector('.button-text-full');

                        if (voice.isPlaying) {
                            voice.stop();
                            equalizer.stop();
                            window.playbackControls.hide();
                            playIconFull.classList.remove('hidden');
                            stopIconFull.classList.add('hidden');
                            buttonTextFull.textContent = 'Full Narration';
                            fullButton.classList.remove('animate-pulse');
                        } else {
                            const text = voice.extractTextFromElement(mainContent);

                            // Show loading overlay immediately
                            voice.showLoadingOverlay();
                            voice.scrollToTop();

                            playIconFull.classList.add('hidden');
                            stopIconFull.classList.remove('hidden');
                            buttonTextFull.textContent = 'Playing...';
                            fullButton.classList.add('animate-pulse');

                            await voice.speak(
                                text,
                                () => {
                                    // onStart - complete progress and hide loading, show notification and equalizer
                                    voice.completeAndHideLoadingOverlay();
                                    const currentVoice = voice.selectedVoice?.name || 'Dameris';
                                    voice.showNotification(`${currentVoice} is narrating the full manifesto...`, 'info', 4000);
                                    equalizer.start();
                                    window.playbackControls.show();
                                },
                                () => {
                                    // onEnd
                                    playIconFull.classList.remove('hidden');
                                    stopIconFull.classList.add('hidden');
                                    buttonTextFull.textContent = 'Full Narration';
                                    fullButton.classList.remove('animate-pulse');
                                    equalizer.stop();
                                    window.playbackControls.hide();
                                    voice.showNotification('Full narration complete', 'success', 2000);
                                },
                                (error) => {
                                    // onError
                                    console.error('Speech error:', error);
                                    voice.hideLoadingOverlay();
                                    playIconFull.classList.remove('hidden');
                                    stopIconFull.classList.add('hidden');
                                    buttonTextFull.textContent = 'Try Again';
                                    fullButton.classList.remove('animate-pulse');
                                    equalizer.stop();
                                    window.playbackControls.hide();
                                    voice.showNotification('Narration failed', 'error', 3000);
                                    setTimeout(() => {
                                        buttonTextFull.textContent = 'Full Narration';
                                    }, 3000);
                                }
                            );
                        }
                    });
                }
            }
        });

        console.log('ðŸŽµ FugueState Sound Engine loaded');
        // Auto-initializes on first user interaction
    </script>

    <script src="/js/sound-control-widget.js"></script>

</body></html>
